services:
  aatm-api:
    build: .
    container_name: aatm-api
    restart: unless-stopped
    ports:
      - "${AATM_API_PORT:-8085}:8080"
      - "${AATM_QBIT_PORT:-8086}:8081"  # qBittorrent WebUI
      - "6881:6881"  # qBittorrent torrent port
      - "6881:6881/udp"
    volumes:
      # Database persistence
      - ./data:/data
      # qBittorrent config persistence
      - ./qbt-config:/config/qBittorrent
      # Full filesystem access for navigation
      - /:/host:ro
      # Media directory with write access for torrents/nfo
      - ${MEDIA_PATH:-/}:/media
      # Output torrents directory
      - ./torrents:/torrents
    environment:
      - PORT=8080
      - DATA_DIR=/data
      - QBT_WEBUI_PORT=8081
      - TZ=${TZ:-Europe/Paris}
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
